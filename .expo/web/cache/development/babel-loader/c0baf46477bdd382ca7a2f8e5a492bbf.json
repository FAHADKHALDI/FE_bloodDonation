{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { makeAutoObservable, runInAction } from \"mobx\";\nimport { instance } from \"./instance\";\nimport decode from \"jwt-decode\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nvar AuthStore = function AuthStore() {\n  var _this = this;\n\n  _classCallCheck(this, AuthStore);\n\n  this.user = null;\n\n  this.setUser = function _callee(token) {\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"myToken\", token));\n\n          case 3:\n            _this.user = decode(token);\n            instance.defaults.headers.common.Authorization = \"Bearer \" + token;\n            _context.next = 10;\n            break;\n\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(\"ðŸš€ ~ file: authStore.js ~ line 20 ~ AuthStore ~ setUser= ~ error\", _context.t0);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.signup = function _callee2(userData, navigation, toast) {\n    var res;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signup\", userData));\n\n          case 3:\n            res = _context2.sent;\n\n            _this.setUser(res.data.token);\n\n            navigation.replace(\"Signin\");\n            _context2.next = 12;\n            break;\n\n          case 8:\n            _context2.prev = 8;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(\"AuthStore -> signup -> error\", _context2.t0);\n            toast.show({\n              status: \"error\",\n              title: \"Invalid Signup\",\n              description: \"The username or password you entered is incorrect\"\n            });\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.signin = function _callee3(user, navigation, toast) {\n    var res;\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signin\", user));\n\n          case 3:\n            res = _context3.sent;\n\n            _this.setUser(res.data.token);\n\n            navigation.replace(\"Timeline\");\n            _context3.next = 11;\n            break;\n\n          case 8:\n            _context3.prev = 8;\n            _context3.t0 = _context3[\"catch\"](0);\n            toast.show({\n              status: \"error\",\n              title: \"Invalid Signin\",\n              description: \"The username or password you entered is incorrect\"\n            });\n\n          case 11:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.logOut = function _callee4(navigation) {\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            delete instance.defaults.headers.common.Authorization;\n            _context4.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"myToken\"));\n\n          case 4:\n            _this.user = null;\n            navigation.replace(\"Signin\");\n            _context4.next = 11;\n            break;\n\n          case 8:\n            _context4.prev = 8;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(_context4.t0);\n\n          case 11:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.checkForToken = function _callee5() {\n    var token, user, userExp;\n    return _regeneratorRuntime.async(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            _context5.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"myToken\"));\n\n          case 3:\n            token = _context5.sent;\n\n            if (token) {\n              user = decode(token);\n              userExp = user.exp;\n\n              if (userExp > Date.now()) {\n                _this.setUser(token);\n              } else {\n                _this.signout();\n              }\n            }\n\n            _context5.next = 10;\n            break;\n\n          case 7:\n            _context5.prev = 7;\n            _context5.t0 = _context5[\"catch\"](0);\n            console.log(\"ðŸš€ ~ file: authStore.js ~ line 82 ~ AuthStore ~ error\", _context5.t0);\n\n          case 10:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.editUser = function _callee6(updatedProfile, toast) {\n    var formData, key, res;\n    return _regeneratorRuntime.async(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.prev = 0;\n            formData = new FormData();\n\n            for (key in updatedProfile) {\n              formData.append(key, updatedProfile[key]);\n            }\n\n            _context6.next = 5;\n            return _regeneratorRuntime.awrap(instance.put(\"/\" + updatedProfile._id, formData));\n\n          case 5:\n            res = _context6.sent;\n            runInAction(function () {\n              _this.user = res.data;\n            });\n            toast.show({\n              title: \"Profile Updated\",\n              status: \"success\",\n              placement: \"top\"\n            });\n            _context6.next = 14;\n            break;\n\n          case 10:\n            _context6.prev = 10;\n            _context6.t0 = _context6[\"catch\"](0);\n            console.error(\"authStore --> updateProfile\", _context6.t0);\n            toast.show({\n              title: \"Unauthorized\",\n              status: \"error\",\n              description: \"You can only edit your profile. \",\n              placement: \"top\"\n            });\n\n          case 14:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, [[0, 10]], Promise);\n  };\n\n  this.updateScore = function _callee7(userId) {\n    var res;\n    return _regeneratorRuntime.async(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            _context7.prev = 0;\n            _context7.next = 3;\n            return _regeneratorRuntime.awrap(instance.put(\"/\" + userId));\n\n          case 3:\n            res = _context7.sent;\n            _this.user = _this.user.map(function (donor) {\n              return donor._id === userId ? res.data : donor;\n            });\n            _context7.next = 10;\n            break;\n\n          case 7:\n            _context7.prev = 7;\n            _context7.t0 = _context7[\"catch\"](0);\n            console.log(\"authStore --> updateScore\", _context7.t0);\n\n          case 10:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  makeAutoObservable(this);\n};\n\nvar authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;","map":{"version":3,"sources":["/Users/aealaskar/Desktop/Development/FE_bloodDonation/stores/authStore.js"],"names":["makeAutoObservable","runInAction","instance","decode","AsyncStorage","AuthStore","user","setUser","token","setItem","defaults","headers","common","Authorization","console","log","signup","userData","navigation","toast","post","res","data","replace","show","status","title","description","signin","logOut","removeItem","checkForToken","getItem","userExp","exp","Date","now","signout","editUser","updatedProfile","formData","FormData","key","append","put","_id","placement","error","updateScore","userId","map","donor","authStore"],"mappings":"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","sourcesContent":["import { makeAutoObservable, runInAction } from \"mobx\";\nimport { instance } from \"./instance\";\nimport decode from \"jwt-decode\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nclass AuthStore {\n  user = null;\n\n  constructor() {\n    makeAutoObservable(this);\n  }\n\n  setUser = async (token) => {\n    try {\n      await AsyncStorage.setItem(\"myToken\", token);\n      this.user = decode(token);\n      instance.defaults.headers.common.Authorization = `Bearer ${token}`;\n    } catch (error) {\n      console.log(\n        \"ðŸš€ ~ file: authStore.js ~ line 20 ~ AuthStore ~ setUser= ~ error\",\n        error\n      );\n    }\n  };\n\n  signup = async (userData, navigation, toast) => {\n    try {\n      const res = await instance.post(\"/signup\", userData);\n      this.setUser(res.data.token);\n      navigation.replace(\"Signin\");\n    } catch (error) {\n      console.log(\"AuthStore -> signup -> error\", error);\n      toast.show({\n        status: \"error\",\n        title: \"Invalid Signup\",\n        description: \"The username or password you entered is incorrect\",\n      });\n    }\n  };\n\n  signin = async (user, navigation, toast) => {\n    try {\n      const res = await instance.post(\"/signin\", user);\n      this.setUser(res.data.token);\n      navigation.replace(\"Timeline\");\n    } catch (error) {\n      toast.show({\n        status: \"error\",\n        title: \"Invalid Signin\",\n        description: \"The username or password you entered is incorrect\",\n      });\n    }\n  };\n\n  logOut = async (navigation) => {\n    try {\n      delete instance.defaults.headers.common.Authorization;\n      await AsyncStorage.removeItem(\"myToken\");\n      this.user = null;\n\n      navigation.replace(\"Signin\");\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  checkForToken = async () => {\n    try {\n      const token = await AsyncStorage.getItem(\"myToken\");\n      if (token) {\n        const user = decode(token);\n        const userExp = user.exp;\n        if (userExp > Date.now()) {\n          this.setUser(token);\n        } else {\n          this.signout();\n        }\n      }\n    } catch (error) {\n      console.log(\n        \"ðŸš€ ~ file: authStore.js ~ line 82 ~ AuthStore ~ error\",\n        error\n      );\n    }\n  };\n\n  editUser = async (updatedProfile, toast) => {\n    try {\n      const formData = new FormData();\n      for (const key in updatedProfile) {\n        formData.append(key, updatedProfile[key]);\n      }\n      const res = await instance.put(`/${updatedProfile._id}`, formData);\n      runInAction(() => {\n        this.user = res.data;\n      });\n\n      toast.show({\n        title: \"Profile Updated\",\n        status: \"success\",\n        placement: \"top\",\n      });\n    } catch (error) {\n      console.error(\"authStore --> updateProfile\", error);\n      toast.show({\n        title: \"Unauthorized\",\n        status: \"error\",\n        description: \"You can only edit your profile. \",\n        placement: \"top\",\n      });\n    }\n  };\n\n  updateScore = async (userId) => {\n    try {\n      const res = await instance.put(`/${userId}`);\n      this.user = this.user.map((donor) =>\n        donor._id === userId ? res.data : donor\n      );\n    } catch (error) {\n      console.log(\"authStore --> updateScore\", error);\n    }\n  };\n}\n\nconst authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;\n"]},"metadata":{},"sourceType":"module"}