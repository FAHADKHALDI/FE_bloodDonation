{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { makeAutoObservable, runInAction } from \"mobx\";\nimport { instance } from \"./instance\";\nimport decode from \"jwt-decode\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nvar AuthStore = function AuthStore() {\n  var _this = this;\n\n  _classCallCheck(this, AuthStore);\n\n  this.user = null;\n\n  this.setUser = function _callee(token) {\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"myToken\", token));\n\n          case 3:\n            _this.user = decode(token);\n            instance.defaults.headers.common.Authorization = \"Bearer \" + token;\n            _context.next = 10;\n            break;\n\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(\"ðŸš€ ~ file: authStore.js ~ line 20 ~ AuthStore ~ setUser= ~ error\", _context.t0);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.signup = function _callee2(userData, navigation, toast) {\n    var res;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signup\", userData));\n\n          case 3:\n            res = _context2.sent;\n\n            _this.setUser(res.data.token);\n\n            navigation.replace(\"Tabs\");\n            _context2.next = 12;\n            break;\n\n          case 8:\n            _context2.prev = 8;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(\"AuthStore -> signup -> error\", _context2.t0);\n            toast.show({\n              status: \"error\",\n              title: \"Invalid Login\",\n              description: \"The username or password you entered is incorrect\"\n            });\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.signin = function _callee3(user, navigation, toast) {\n    var res;\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signin\", user));\n\n          case 3:\n            res = _context3.sent;\n\n            _this.setUser(res.data.token);\n\n            navigation.replace(\"Tabs\");\n            _context3.next = 11;\n            break;\n\n          case 8:\n            _context3.prev = 8;\n            _context3.t0 = _context3[\"catch\"](0);\n            toast.show({\n              status: \"error\",\n              title: \"Invalid Login\",\n              description: \"The username or password you entered is incorrect\"\n            });\n\n          case 11:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.signout = function _callee4() {\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            delete instance.defaults.headers.common.Authorization;\n            _context4.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"myToken\"));\n\n          case 4:\n            runInAction(function () {\n              _this.user = null;\n            });\n            _context4.next = 10;\n            break;\n\n          case 7:\n            _context4.prev = 7;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(\"ðŸš€ ~ file: authStore.js ~ line 62 ~ AuthStore ~ signout= ~ error\", _context4.t0);\n\n          case 10:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.checkForToken = function _callee5() {\n    var token, user, userExp;\n    return _regeneratorRuntime.async(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            _context5.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"myToken\"));\n\n          case 3:\n            token = _context5.sent;\n\n            if (token) {\n              user = decode(token);\n              userExp = user.exp * 1000;\n\n              if (userExp > Date.now()) {\n                _this.setUser(token);\n              } else {\n                _this.signout();\n              }\n            }\n\n            _context5.next = 10;\n            break;\n\n          case 7:\n            _context5.prev = 7;\n            _context5.t0 = _context5[\"catch\"](0);\n            console.log(\"ðŸš€ ~ file: authStore.js ~ line 82 ~ AuthStore ~ error\", _context5.t0);\n\n          case 10:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.editUser = function _callee6(updatedProfile, toast) {\n    var formData, key, res;\n    return _regeneratorRuntime.async(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.prev = 0;\n            formData = new FormData();\n\n            for (key in updatedProfile) {\n              formData.append(key, updatedProfile[key]);\n            }\n\n            _context6.next = 5;\n            return _regeneratorRuntime.awrap(instance.put(\"/\" + updatedProfile._id, formData));\n\n          case 5:\n            res = _context6.sent;\n            runInAction(function () {\n              _this.user = res.data;\n            });\n            toast.show({\n              title: \"Profile Updated\",\n              status: \"success\",\n              placement: \"top\"\n            });\n            _context6.next = 14;\n            break;\n\n          case 10:\n            _context6.prev = 10;\n            _context6.t0 = _context6[\"catch\"](0);\n            console.error(\"profileStore --> updateProfile\", _context6.t0);\n            toast.show({\n              title: \"Unauthorized\",\n              status: \"error\",\n              description: \"You can only edit your profile. \",\n              placement: \"top\"\n            });\n\n          case 14:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, [[0, 10]], Promise);\n  };\n\n  makeAutoObservable(this);\n};\n\nvar authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;","map":{"version":3,"sources":["/Users/aealaskar/Desktop/Development/FE_bloodDonation/stores/authStore.js"],"names":["makeAutoObservable","runInAction","instance","decode","AsyncStorage","AuthStore","user","setUser","token","setItem","defaults","headers","common","Authorization","console","log","signup","userData","navigation","toast","post","res","data","replace","show","status","title","description","signin","signout","removeItem","checkForToken","getItem","userExp","exp","Date","now","editUser","updatedProfile","formData","FormData","key","append","put","_id","placement","error","authStore"],"mappings":"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","sourcesContent":["import { makeAutoObservable, runInAction } from \"mobx\";\nimport { instance } from \"./instance\";\nimport decode from \"jwt-decode\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nclass AuthStore {\n\tuser = null;\n\n\tconstructor() {\n\t\tmakeAutoObservable(this);\n\t}\n\n\tsetUser = async (token) => {\n\t\ttry {\n\t\t\tawait AsyncStorage.setItem(\"myToken\", token);\n\t\t\tthis.user = decode(token);\n\t\t\tinstance.defaults.headers.common.Authorization = `Bearer ${token}`;\n\t\t} catch (error) {\n\t\t\tconsole.log(\n\t\t\t\t\"ðŸš€ ~ file: authStore.js ~ line 20 ~ AuthStore ~ setUser= ~ error\",\n\t\t\t\terror\n\t\t\t);\n\t\t}\n\t};\n\n\tsignup = async (userData, navigation, toast) => {\n\t\ttry {\n\t\t\tconst res = await instance.post(\"/signup\", userData);\n\t\t\tthis.setUser(res.data.token);\n\t\t\tnavigation.replace(\"Tabs\");\n\t\t} catch (error) {\n\t\t\tconsole.log(\"AuthStore -> signup -> error\", error);\n\t\t\ttoast.show({\n\t\t\t\tstatus: \"error\",\n\t\t\t\ttitle: \"Invalid Login\",\n\t\t\t\tdescription: \"The username or password you entered is incorrect\",\n\t\t\t});\n\t\t}\n\t};\n\n\tsignin = async (user, navigation, toast) => {\n\t\ttry {\n\t\t\tconst res = await instance.post(\"/signin\", user);\n\t\t\tthis.setUser(res.data.token);\n\t\t\tnavigation.replace(\"Tabs\");\n\t\t} catch (error) {\n\t\t\ttoast.show({\n\t\t\t\tstatus: \"error\",\n\t\t\t\ttitle: \"Invalid Login\",\n\t\t\t\tdescription: \"The username or password you entered is incorrect\",\n\t\t\t});\n\t\t}\n\t};\n\n\tsignout = async () => {\n\t\ttry {\n\t\t\tdelete instance.defaults.headers.common.Authorization;\n\t\t\tawait AsyncStorage.removeItem(\"myToken\");\n\t\t\trunInAction(() => {\n\t\t\t\tthis.user = null;\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tconsole.log(\n\t\t\t\t\"ðŸš€ ~ file: authStore.js ~ line 62 ~ AuthStore ~ signout= ~ error\",\n\t\t\t\terror\n\t\t\t);\n\t\t}\n\t};\n\n\tcheckForToken = async () => {\n\t\ttry {\n\t\t\tconst token = await AsyncStorage.getItem(\"myToken\");\n\t\t\tif (token) {\n\t\t\t\tconst user = decode(token);\n\t\t\t\tconst userExp = user.exp * 1000;\n\t\t\t\tif (userExp > Date.now()) {\n\t\t\t\t\tthis.setUser(token);\n\t\t\t\t} else {\n\t\t\t\t\tthis.signout();\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(\n\t\t\t\t\"ðŸš€ ~ file: authStore.js ~ line 82 ~ AuthStore ~ error\",\n\t\t\t\terror\n\t\t\t);\n\t\t}\n\t};\n\teditUser = async (updatedProfile, toast) => {\n\t\ttry {\n\t\t\tconst formData = new FormData();\n\t\t\tfor (const key in updatedProfile) {\n\t\t\t\tformData.append(key, updatedProfile[key]);\n\t\t\t}\n\t\t\tconst res = await instance.put(`/${updatedProfile._id}`, formData);\n\t\t\trunInAction(() => {\n\t\t\t\tthis.user = res.data;\n\t\t\t});\n\n\t\t\ttoast.show({\n\t\t\t\ttitle: \"Profile Updated\",\n\t\t\t\tstatus: \"success\",\n\t\t\t\tplacement: \"top\",\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tconsole.error(\"profileStore --> updateProfile\", error);\n\t\t\ttoast.show({\n\t\t\t\ttitle: \"Unauthorized\",\n\t\t\t\tstatus: \"error\",\n\t\t\t\tdescription: \"You can only edit your profile. \",\n\t\t\t\tplacement: \"top\",\n\t\t\t});\n\t\t}\n\t};\n}\n\nconst authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;\n"]},"metadata":{},"sourceType":"module"}