{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { makeAutoObservable, runInAction } from \"mobx\";\nimport { instance } from \"./instance\";\nimport decode from \"jwt-decode\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nvar AuthStore = function AuthStore() {\n  var _this = this;\n\n  _classCallCheck(this, AuthStore);\n\n  this.user = null;\n\n  this.setUser = function _callee(token) {\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"myToken\", token));\n\n          case 3:\n            _this.user = decode(token);\n            instance.defaults.headers.common.Authorization = \"Bearer \" + token;\n            _context.next = 10;\n            break;\n\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(\"ðŸš€ ~ file: authStore.js ~ line 20 ~ AuthStore ~ setUser= ~ error\", _context.t0);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.signup = function _callee2(userData, navigation, toast) {\n    var res;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signup\", userData));\n\n          case 3:\n            res = _context2.sent;\n\n            _this.setUser(res.data.token);\n\n            navigation.replace(\"Timeline\");\n            _context2.next = 12;\n            break;\n\n          case 8:\n            _context2.prev = 8;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(\"AuthStore -> signup -> error\", _context2.t0);\n            toast.show({\n              status: \"error\",\n              title: \"Invalid Signup\",\n              description: \"The username or password you entered is incorrect\"\n            });\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.signin = function _callee3(user, navigation, toast) {\n    var res;\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signin\", user));\n\n          case 3:\n            res = _context3.sent;\n\n            _this.setUser(res.data.token);\n\n            navigation.replace(\"Timeline\");\n            _context3.next = 11;\n            break;\n\n          case 8:\n            _context3.prev = 8;\n            _context3.t0 = _context3[\"catch\"](0);\n            toast.show({\n              status: \"error\",\n              title: \"Invalid Signin\",\n              description: \"The username or password you entered is incorrect\"\n            });\n\n          case 11:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.logOut = function _callee4(navigation) {\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            delete instance.defaults.headers.common.Authorization;\n            _context4.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"myToken\"));\n\n          case 4:\n            _this.user = null;\n            navigation.replace(\"Signin\");\n            _context4.next = 11;\n            break;\n\n          case 8:\n            _context4.prev = 8;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(_context4.t0);\n\n          case 11:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.checkForToken = function _callee5() {\n    var token, user, userExp;\n    return _regeneratorRuntime.async(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            _context5.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"myToken\"));\n\n          case 3:\n            token = _context5.sent;\n\n            if (token) {\n              user = decode(token);\n              userExp = user.exp;\n\n              if (userExp > Date.now()) {\n                _this.setUser(token);\n              } else {\n                _this.signout();\n              }\n            }\n\n            _context5.next = 10;\n            break;\n\n          case 7:\n            _context5.prev = 7;\n            _context5.t0 = _context5[\"catch\"](0);\n            console.log(\"ðŸš€ ~ file: authStore.js ~ line 82 ~ AuthStore ~ error\", _context5.t0);\n\n          case 10:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.editUser = function _callee6(updatedProfileId, updatedProfile, toast) {\n    var res;\n    return _regeneratorRuntime.async(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.prev = 0;\n            _context6.next = 3;\n            return _regeneratorRuntime.awrap(instance.put(\"/\" + updatedProfileId, updatedProfile));\n\n          case 3:\n            res = _context6.sent;\n            runInAction(function () {\n              _this.user = res.data;\n            });\n            toast.show({\n              title: \"Profile Updated\",\n              status: \"success\",\n              placement: \"top\"\n            });\n            _context6.next = 13;\n            break;\n\n          case 8:\n            _context6.prev = 8;\n            _context6.t0 = _context6[\"catch\"](0);\n            console.error(\"authStore --> updateProfile\", _context6.t0);\n            console.log(updatedProfile);\n            toast.show({\n              title: \"Unauthorized\",\n              status: \"error\",\n              description: \"You can only edit your profile. \",\n              placement: \"top\"\n            });\n\n          case 13:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.updateScore = function _callee7(userId) {\n    var res;\n    return _regeneratorRuntime.async(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            _context7.prev = 0;\n            _context7.next = 3;\n            return _regeneratorRuntime.awrap(instance.put(\"/\" + userId));\n\n          case 3:\n            res = _context7.sent;\n            _this.user = res.data;\n            _context7.next = 10;\n            break;\n\n          case 7:\n            _context7.prev = 7;\n            _context7.t0 = _context7[\"catch\"](0);\n            console.log(\"authStore --> updateScore\", _context7.t0);\n\n          case 10:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  makeAutoObservable(this);\n};\n\nvar authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;","map":{"version":3,"sources":["C:/Users/fahad/Development/FE_bloodDonation/stores/authStore.js"],"names":["makeAutoObservable","runInAction","instance","decode","AsyncStorage","AuthStore","user","setUser","token","setItem","defaults","headers","common","Authorization","console","log","signup","userData","navigation","toast","post","res","data","replace","show","status","title","description","signin","logOut","removeItem","checkForToken","getItem","userExp","exp","Date","now","signout","editUser","updatedProfileId","updatedProfile","put","placement","error","updateScore","userId","authStore"],"mappings":"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","sourcesContent":["import { makeAutoObservable, runInAction } from \"mobx\";\r\nimport { instance } from \"./instance\";\r\nimport decode from \"jwt-decode\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\n\r\nclass AuthStore {\r\n  user = null;\r\n\r\n  constructor() {\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  setUser = async (token) => {\r\n    try {\r\n      await AsyncStorage.setItem(\"myToken\", token);\r\n      this.user = decode(token);\r\n      instance.defaults.headers.common.Authorization = `Bearer ${token}`;\r\n    } catch (error) {\r\n      console.log(\r\n        \"ðŸš€ ~ file: authStore.js ~ line 20 ~ AuthStore ~ setUser= ~ error\",\r\n        error\r\n      );\r\n    }\r\n  };\r\n\r\n  signup = async (userData, navigation, toast) => {\r\n    try {\r\n      const res = await instance.post(\"/signup\", userData);\r\n      this.setUser(res.data.token);\r\n      navigation.replace(\"Timeline\");\r\n    } catch (error) {\r\n      console.log(\"AuthStore -> signup -> error\", error);\r\n      toast.show({\r\n        status: \"error\",\r\n        title: \"Invalid Signup\",\r\n        description: \"The username or password you entered is incorrect\",\r\n      });\r\n    }\r\n  };\r\n\r\n  signin = async (user, navigation, toast) => {\r\n    try {\r\n      const res = await instance.post(\"/signin\", user);\r\n      this.setUser(res.data.token);\r\n      navigation.replace(\"Timeline\");\r\n    } catch (error) {\r\n      toast.show({\r\n        status: \"error\",\r\n        title: \"Invalid Signin\",\r\n        description: \"The username or password you entered is incorrect\",\r\n      });\r\n    }\r\n  };\r\n\r\n  logOut = async (navigation) => {\r\n    try {\r\n      delete instance.defaults.headers.common.Authorization;\r\n      await AsyncStorage.removeItem(\"myToken\");\r\n      this.user = null;\r\n\r\n      navigation.replace(\"Signin\");\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  checkForToken = async () => {\r\n    try {\r\n      const token = await AsyncStorage.getItem(\"myToken\");\r\n      if (token) {\r\n        const user = decode(token);\r\n        const userExp = user.exp;\r\n        if (userExp > Date.now()) {\r\n          this.setUser(token);\r\n        } else {\r\n          this.signout();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.log(\r\n        \"ðŸš€ ~ file: authStore.js ~ line 82 ~ AuthStore ~ error\",\r\n        error\r\n      );\r\n    }\r\n  };\r\n\r\n  editUser = async (updatedProfileId, updatedProfile, toast) => {\r\n    try {\r\n      const res = await instance.put(`/${updatedProfileId}`, updatedProfile);\r\n\r\n      runInAction(() => {\r\n        this.user = res.data;\r\n      });\r\n\r\n      toast.show({\r\n        title: \"Profile Updated\",\r\n        status: \"success\",\r\n        placement: \"top\",\r\n      });\r\n    } catch (error) {\r\n      console.error(\"authStore --> updateProfile\", error);\r\n      console.log(updatedProfile);\r\n      toast.show({\r\n        title: \"Unauthorized\",\r\n        status: \"error\",\r\n        description: \"You can only edit your profile. \",\r\n        placement: \"top\",\r\n      });\r\n    }\r\n  };\r\n\r\n  updateScore = async (userId) => {\r\n    try {\r\n      const res = await instance.put(`/${userId}`);\r\n      this.user = res.data;\r\n    } catch (error) {\r\n      console.log(\"authStore --> updateScore\", error);\r\n    }\r\n  };\r\n}\r\n\r\nconst authStore = new AuthStore();\r\nauthStore.checkForToken();\r\nexport default authStore;\r\n"]},"metadata":{},"sourceType":"module"}